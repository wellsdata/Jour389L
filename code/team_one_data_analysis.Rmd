---
title: "Geographic Analysis"
author: "Rob Wells"
date: "2023-09-20"
output: html_document
---


The ANALYSIS
--Looks at In state / out of state coverage
--Distance over time
--Southern vs other regions

```{r}
#install.packages("here")
here::here()
library(tidyverse)
library(tidyr)
#install.packages("ggmap")
library(ggmap)
#register_google(key = "YOUR KEY HERE")
library(googlesheets4)
#install.packages("geosphere")
library(geosphere)
#install.packages("expss")
library(expss)
```
# Analysis
```{r}
lynch_geocoded_9.16 <- read.csv("../data/lynch_geocoded_9.16.csv")

```

# Basic Analysis, Duplicated Entries
```{r}
## Pct of Newspapers in state vs out of state
 lynch_geocoded_9.16 %>% 
  count(in_state) %>% 
  mutate(pct = round(n/3292,2))


# in_state
# N	3068	0.93		
# Y	223	0.07	

summary(lynch_geocoded_9.16$miles)
#Newspapers, on average, were 878 miles away from a lynching event during the whole time period

duplicated_entries <- lynch_geocoded_9.16 %>% 
  group_by(file_id) %>% 
  count(lynch_address) %>% 
  filter(n > 1)

# Repetitions: 
write_sheet(duplicated_entries, "https://docs.google.com/spreadsheets/d/1mt-K372GEtjE_v0qeiX-57MlnAD-9tT5f4AZr4NxZnY/edit#gid=0")


```

## In State v Out of State by Decade
```{r}

x <- lynch_geocoded_9.16 %>% 
  select(decade, miles, in_state) %>% 
  group_by(decade) %>% 
  count(in_state)

  ggplot(x, aes(x=decade, y=n, color=in_state, fill=in_state)) +
    geom_col(position = "dodge") + 
  theme(legend.position = "none") +
  labs(title = "DRAFT FINDINGS: Little Local Coverage of Lynching",
       subtitle = "Local (teal) vs Out-of-State (red) Lynching Coverage",
       caption = "Teal bar=In-state. Red Bar=Out-of-State. Source: Library of Congress. n=3188 Graphic by Rob Wells. Sept 20 2024",
       y="Count of articles",
       x="")

  
cleaned_articles <- lynch_geocoded_9.16 %>% 
  distinct(file_id, lynch_address, .keep_all = TRUE) %>% 
  mutate(location = case_when(
    newspaper_state_code == state_lynch ~ "in_state",
    TRUE~"out_of_state"
  ))
  
decade_data <- cleaned_articles %>% 
  group_by(decade, location) %>% 
  count(.) %>% 
  pivot_wider(names_from = location, values_from = n) %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(sum_articles = out_of_state + in_state) %>% 
  mutate(percent_oos = round(out_of_state/sum_articles*100, 2)) %>% 
  mutate(percent_is = round(in_state/sum_articles*100, 2))

write_sheet(decade_data, "https://docs.google.com/spreadsheets/d/1udiQCGe-Qou-WlAiBYJgW23AccOx-_4pNHKNjzIreXA/edit#gid=0")

state_groupings <- cleaned_articles %>%
  group_by(newspaper_state_code, location) %>% 
  count(.) %>% 
  pivot_wider(names_from = location, values_from = n) %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(sum_articles = out_of_state + in_state) %>% 
  mutate(percent_oos = round(out_of_state/sum_articles*100, 2)) %>% 
  mutate(percent_is = round(in_state/sum_articles*100, 2))

write_sheet(state_groupings, "https://docs.google.com/spreadsheets/d/1udiQCGe-Qou-WlAiBYJgW23AccOx-_4pNHKNjzIreXA/edit#gid=0")

```


# Analyze Lynching Data Trends
```{r}
tolnay_beck <- read_csv("../data/Bailey_Beck_lynching_list_8_1_2022.csv") %>% 
  as.data.frame()

tolnay_beck <- janitor::clean_names(tolnay_beck)

```

## Regional classification for newspaper
```{r}
#Adapt this code to the tolnay_beck data to create a regional identifier



lynch_geocoded_9.27 <- lynch_geocoded_9.27 %>% 
  mutate(Newspaper_Region2=Newspaper_State) %>% 
  mutate(Newspaper_Region2 = case_when(Newspaper_State=="South Carolina" ~ "South",
                           Newspaper_State=="Texas" ~ "South",
                            Newspaper_State=="Louisiana" ~ "South",
                            Newspaper_State=="Tennessee" ~ "South",
                            Newspaper_State=="Mississippi" ~ "South",
                            Newspaper_State=="Arkansas" ~ "South",
                            Newspaper_State=="Alabama" ~ "South",
                            Newspaper_State=="Georgia" ~ "South",
                            Newspaper_State=="Virginia" ~ "South",
                            Newspaper_State=="Florida" ~ "South",
                            Newspaper_State=="North Carolina" ~ "South",
                            Newspaper_State=="Maryland" ~ "Border",
                            Newspaper_State=="Delaware" ~ "Border",
                            Newspaper_State=="West Virginia" ~ "Border",
                            Newspaper_State=="Kentucky" ~ "Border",
                            Newspaper_State=="Missouri" ~ "Border",
                            Newspaper_State=="Maine" ~ "North",
                            Newspaper_State=="New York" ~ "North",
                            Newspaper_State=="New Hampshire" ~ "North",
                            Newspaper_State=="Vermont" ~ "North",
                            Newspaper_State=="Massassachusetts" ~ "North",
                            Newspaper_State=="Connecticut" ~ "North",
                            Newspaper_State=="Rhode Island" ~ "North",
                            Newspaper_State=="Pennsylvania" ~ "North",
                            Newspaper_State=="New Jersey" ~ "North",
                            Newspaper_State=="Ohio" ~ "North",
                            Newspaper_State=="Indiana" ~ "North",
                            Newspaper_State=="Kansas" ~ "North",
                            Newspaper_State=="Michigan" ~ "North",
                             Newspaper_State=="Wisconsin" ~ "North",
                             Newspaper_State=="Minnesota" ~ "North",
                             Newspaper_State=="Iowa" ~ "North",
                             Newspaper_State=="California" ~ "North",
                             Newspaper_State=="Nevada" ~ "North",
                             Newspaper_State=="Oregon" ~ "North",
                            Newspaper_State=="Illinois" ~ "North",
                            Newspaper_State=="Nebraska" ~ "Misc",
                            Newspaper_State=="Colorado" ~ "Misc",
                            Newspaper_State=="North Dakota" ~ "Misc",
                            Newspaper_State=="South Dakota" ~ "Misc",
                            Newspaper_State=="Montana" ~ "Misc",
                            Newspaper_State=="Washington" ~ "Misc",
                            Newspaper_State=="Idaho" ~ "Misc",
                            Newspaper_State=="Wyoming" ~ "Misc",
                            Newspaper_State=="Utah" ~ "Misc",
                            Newspaper_State=="Oklahoma" ~ "Misc",
                            Newspaper_State=="New Mexico" ~ "Misc",
                            Newspaper_State=="Arizona" ~ "Misc",
                            Newspaper_State=="Alaska" ~ "Misc",
                            Newspaper_State=="Hawaii" ~ "Misc",
                            Newspaper_State=="District of Columbia" ~ "Misc",
                            Newspaper_State=="Virgin Islands" ~ "Misc",
                                                     TRUE~Newspaper_State)) 


#write.csv(lynch_geocoded_9.27, "../data/lynch_geocoded_9.27.csv")
```